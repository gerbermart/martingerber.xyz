<!DOCTYPE html>
<html>
<head>
  <title>Wallet Connect Example</title>
</head>
<body>
  <div id="connect-container">
    <div id="connect-link-container" style="display: none;">
      <a id="connect-link" href="javascript:void(0)" onclick="getWalletAddress()">Click Me</a>
    </div>
    <div id="result-container" style="display: none;"></div>
  </div>

  <script>
    function doneLoading() {
      // Web3 library has finished loading
      var connectLinkContainer = document.getElementById("connect-link-container");
      connectLinkContainer.style.display = "block"; // Make the link visible
    }

    async function getWalletAddress() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          var accounts = await window.ethereum.request({ method: 'eth_accounts' });
          if (accounts.length > 0) {
            var walletAddress = accounts[0];
            console.log("Wallet Address:", walletAddress);
            // Use the wallet address as needed
            checkKeys(walletAddress); // Call checkKeys() with the wallet address
          } else {
            console.error("No accounts found.");
          }
        } catch (error) {
          console.error(error);
        }
      } else {
        console.error("MetaMask is not available.");
      }
    }

    async function checkKeys(walletAddress) {
      var contractAddresses = ['0xd8fabd716eccbf98157f6728d3c187625a513127', '0xb0e5faac1429592cea8a70f8828d7bd88b788e82', '0x349dbadc6d24eb7e534ef230db01a35208e49d04','0x9a1dfe64442701daf7fff81434a3c0792eed107f']; // Replace with your desired contract addresses
      var contractAddressNames = ['GERBS','NORLI','BONES','TUNES'];

      var contractsWithBalance = [];
      for (var i = 0; i < contractAddresses.length; i++) {
        var contractAddress = contractAddresses[i];
        try {
          var response = await fetch(`https://api.opensea.io/api/v1/collections?asset_owner=${walletAddress}&asset_contract_address=${contractAddress}`);
          var data = await response.json();
          if (data && data.length > 0) {
            var balance = data[0].balance;
            if (balance > 0) {
              var index = contractAddresses.indexOf(contractAddress);
              if (index !== -1) {
                var contractName = contractAddressNames[index];
                console.log("User has a balance for contract", contractAddress, "(" + contractName + ")");
                contractsWithBalance.push(contractName);
              }
            }
          }
        } catch (error) {
          console.error(error);
        }
      }

      if (contractsWithBalance.length > 0) {
        var contractList = contractsWithBalance.join(", ");
        console.log("User has a balance for contracts:", contractList);
        var resultContainer = document.getElementById("result-container");
        resultContainer.innerHTML = "User has a balance for contracts: " + contractList;
        resultContainer.style.display = "block";
        var connectContainer = document.getElementById("connect-container");
        connectContainer.style.display = "none";
        var connectLink = document.getElementById("connect-link");
        connectLink.innerHTML = "<a href='x.html' target='_blank'>Allowlist Mint Unlocked</a>";
      } else {
        console.log("User has zero balance for all contracts");
        var resultContainer = document.getElementById("result-container");
        resultContainer.innerHTML = "User has zero balance for all contracts";
        resultContainer.style.display = "block";
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js" onload="doneLoading()"></script>
</body>
</html>
