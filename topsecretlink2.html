<!DOCTYPE html>
<html>
<head>
    <title>ETH Mint Landing Page</title>
    <meta name="description" content="come explore the music & artwork of Martin Gerber (aka Marty Gerbs)">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta property="og:title" content="Martin Gerber aka Marty Gerbs">
    <meta property="og:type" content="article" />
    <meta property="og:description" content="come explore the music & artwork of Martin Gerber (aka Marty Gerbs)">
    <meta property="og:image" content="https://martingerber.xyz/card.jpg">
    <meta property="og:url" content="https://martingerber.xyz/index.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style_mint.css">
    
</head>
<body>
    <div id="video-background">
        <video id="loading-video" autoplay loop muted playsinline>
            <source src="IMAGES/LOADING.mp4" type="video/mp4">
        </video>
        <video id="video-content" style="display: none;" autoplay loop muted playsinline>
            <source src="IMAGES/MINT.mp4" type="video/mp4">
        </video>
        <div class="content-container" id="content-container" style="display: none;">
            <div class="buttons-container">
                <div class="title">GOERLI mint is LIVE!</div>
                <div class="button-and-input-container">
                    <a onclick="mintAlbum()" id="mintButton" class="button" target="_blank" rel="noopener noreferrer">PUBLIC MINT (0.01 GÃ¶ETH)</a>
                    <input type="number" id="mintCountInput" class="input" placeholder="Mint Count" value="1">
                </div>
                <br><br>
                <a onclick="freeMint()" id="freeMintButton" class="button" target="_blank" rel="noopener noreferrer">ALLOWLIST MINT (ONE FREE)</a>
                <br><br>
                <a href="https://testnets.opensea.io/assets/goerli/0x85a9aa7ebed05aa1d1b0ff1032ec5387d4f67e56/1" class="button" target="_blank" rel="noopener noreferrer">VIEW ON OPENSEA</a>
            </div>
        </div>
    </div>
    <script>
        function doneLoading() {
            document.getElementById("content-container").style.display = "block";
            document.getElementById("video-content").style.display = "block";
        }
    </script>
    <script>
        
        const contractAddress = '0x85a9aa7ebed05aa1d1b0ff1032ec5387d4f67e56'; // Replace with the actual contract address
        const contractABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"addr","type":"address"}],"name":"AddressAllowed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"inputs":[],"name":"ALBUM_ID","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"addresses","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"allowLive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"allow_addresses","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"allowed_addresses","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"uri_input","type":"string"},{"internalType":"address payable","name":"addressInput","type":"address"}],"name":"createNewToken","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"freeMint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getTokenUri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"addr","type":"address"}],"name":"hasClaimed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"addr","type":"address"}],"name":"isAllowlisted","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"mintCount","type":"uint256"}],"name":"mintAlbum","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"mintPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicLive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"newAlbumId","type":"uint256"}],"name":"setAlbumId","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"newAllowLive","type":"bool"}],"name":"setAllowLive","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newMintPrice","type":"uint256"}],"name":"setMintPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address payable","name":"addressInput","type":"address"}],"name":"setPayout","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"newPublicLive","type":"bool"}],"name":"setPublicLive","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"uriInput","type":"string"}],"name":"setTokenUri","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"string","name":"newURI","type":"string"}],"name":"setURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"totalMints","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}];
        async function checkNetwork(buttonID) {
            const expectedNetwork = 'goerli'; // Replace with the expected network name
            var flag=true;
            if (window.ethereum && window.ethereum.isMetaMask) {
                const provider = new Web3(window.ethereum);
                const network = await provider.eth.net.getNetworkType();

                if (network !== expectedNetwork) {
                    //throw new Error(`Please switch to the ${expectedNetwork} network.`);
                    document.getElementById(buttonID).innerText = `Please switch to the ${expectedNetwork} network, and refresh.`;
                    document.getElementById(buttonID).disabled = true;
                    document.getElementById(buttonID).style.backgroundColor = '#b64917';
                    document.getElementById(buttonID).style.color = '#fff';
                    flag=false;
                }
            } else {
                //throw new Error('Please install MetaMask extension to interact with the network.');
                document.getElementById(buttonID).innerText = 'Please install MetaMask extension to interact with the network, and refresh.';
                document.getElementById(buttonID).disabled = true;
                document.getElementById(buttonID).style.backgroundColor = '#b64917';
                document.getElementById(buttonID).style.color = '#fff';
                flag=false;
            }
            return flag;
        }

        async function mintAlbum() {
            var netFlag = await checkNetwork('mintButton');
            if (netFlag) {
                try {
                    if (window.ethereum && window.ethereum.isMetaMask) {
                        await window.ethereum.request({ method: 'eth_requestAccounts' });
                        const provider = new Web3(window.ethereum);
                        
                        const contract = new provider.eth.Contract(contractABI, contractAddress);

                        const publicLive = await contract.methods.publicLive().call();
                        
                        if (!publicLive) {
                            throw new Error('Public mint is closed');
                        }

                        const mintCountInput = document.getElementById('mintCountInput');
                        const mintCount = mintCountInput.value || 1; // Replace with the desired mint count

                        const mintPrice = await contract.methods.mintPrice().call();
                        const totalAmount = mintPrice * mintCount;

                        const accounts = await provider.eth.getAccounts();
                        const from = accounts[0];

                        const options = {
                            from,
                            value: totalAmount.toString()
                        };

                        const transaction = contract.methods.mintAlbum(1, mintCount).send(options);
                        transaction.on('transactionHash', function (hash) {
                            console.log('Transaction hash:', hash);
                            document.getElementById('mintButton').onclick=function(event) {
                                event.preventDefault();
                                window.open('https://goerli.etherscan.io/tx/'+hash, "_blank");
                                win.opener = null;
                            };
                            document.getElementById('mintButton').innerText = 'Minting...';
                            // Change the video source to "CELEBRATE.mp4"
                            const videoContainer = document.getElementById('video-background');
                            const videoElement = document.getElementById('video-content');
                            videoElement.src = 'IMAGES/MINT.mp4';
                            videoContainer.style.background = 'transparent';
                            //document.getElementById('mintButton').disabled = true;
                            //alert('Transaction Hash: ' + hash);
                        });

                        const receipt = await transaction;

                        console.log('Mint transaction sent successfully!');
                        document.getElementById('mintButton').onclick=function(event) {
                            event.preventDefault();
                            window.open('https://goerli.etherscan.io/tx/'+receipt.transactionHash, "_blank");
                            win.opener = null;
                        };
                        document.getElementById('mintButton').innerText = 'MINT COMPLETE!';
                        // Change the video source to "MINT.mp4"
                        const videoContainer = document.getElementById('video-background');
                        const videoElement = document.getElementById('video-content');
                        videoElement.src = 'IMAGES/CELEBRATE.mp4';
                        videoContainer.style.background = 'transparent';
                        //document.getElementById('mintButton').disabled = false;
                        //alert('MINT COMPLETE!\nTransaction Hash: ' + receipt.transactionHash);
                    } else {
                        throw new Error('MetaMask required');
                    }
                } catch (error) {
                    console.error('Error occurred while minting:', error);
                    document.getElementById('mintButton').innerText = error.message;
                    document.getElementById('mintButton').disabled = true;
                    document.getElementById('mintButton').style.backgroundColor = '#b64917';
                    document.getElementById('mintButton').style.color = '#fff';
                    //alert('Error occurred while minting: ' + error.message);
                }

            }
        }

        async function freeMint() {
            var netFlag = await checkNetwork('freeMintButton');
            if (netFlag) {
                try {
                    if (window.ethereum && window.ethereum.isMetaMask) {
                        await window.ethereum.request({ method: 'eth_requestAccounts' });
                        const provider = new Web3(window.ethereum);

                        const contract = new provider.eth.Contract(contractABI, contractAddress);

                        const allowLive = await contract.methods.allowLive().call();
                        
                        if (!allowLive) {
                            throw new Error('Allowlist mint is closed');
                        }

                        const accounts = await provider.eth.getAccounts();
                        const from = accounts[0];

                        const isAllowed = await contract.methods.isAllowlisted(from).call();

                        if (!isAllowed) {
                            throw new Error('Address not on allowlist');
                        }

                        const hasClaimed = await contract.methods.hasClaimed(from).call();

                        if (hasClaimed) {
                            throw new Error('Allowlist address already claimed free mint');
                        }

                        const options = {
                            from
                        };

                        const transaction = contract.methods.freeMint(1).send(options);
                        transaction.on('transactionHash', function (hash) {
                            console.log('Transaction hash:', hash);
                            document.getElementById('freeMintButton').onclick=function(event) {
                                event.preventDefault();
                                window.open('https://goerli.etherscan.io/tx/'+hash, "_blank");
                                win.opener = null;
                            };
                            document.getElementById('freeMintButton').innerText = 'Minting...';
                            // Change the video source to "MINT.mp4"
                            const videoContainer = document.getElementById('video-background');
                            const videoElement = document.getElementById('video-content');
                            videoElement.src = 'IMAGES/MINT.mp4';
                            videoContainer.style.background = 'transparent';
                            //document.getElementById('freeMintButton').disabled = true;
                            //alert('Transaction Hash: ' + hash);
                        });

                        const receipt = await transaction;

                        console.log('Free Mint transaction sent successfully!');
                        document.getElementById('freeMintButton').onclick=function(event) {
                            event.preventDefault();
                            window.open('https://goerli.etherscan.io/tx/'+receipt.transactionHash, "_blank");
                            win.opener = null;
                        };
                        document.getElementById('freeMintButton').innerText = 'MINT COMPLETE!';
                        // Change the video source to "CELEBRATE.mp4"
                        const videoContainer = document.getElementById('video-background');
                        const videoElement = document.getElementById('video-content');
                        videoElement.src = 'IMAGES/CELEBRATE.mp4';
                        videoContainer.style.background = 'transparent';
                        //document.getElementById('freeMintButton').disabled = false;
                        //alert('MINT COMPLETE!\nTransaction Hash: ' + receipt.transactionHash);
                    } else {
                        throw new Error('MetaMask required');
                    }
                } catch (error) {
                    console.error('Error occurred while free minting:', error);
                    document.getElementById('freeMintButton').innerText = error.message;
                    document.getElementById('freeMintButton').disabled = true;
                    document.getElementById('freeMintButton').style.backgroundColor = '#b64917';
                    document.getElementById('freeMintButton').style.color = '#fff';
                    //alert('Error occurred while free minting: ' + error.message);
                }
            }
                
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js" onload="doneLoading()"></script>
</body>
</html>
