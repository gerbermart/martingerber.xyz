<!DOCTYPE html>
<html>
<head>
    <title>ETH Mint Landing Page</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        #video-background {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        #video-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .content-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .title {
            font-size: 4vw;
            margin-bottom: 2vw;
            white-space: nowrap;
        }

        .buttons-container {
            margin-top: 2vw;
        }

        .button {
            display: inline-block;
            padding: 1.5vw 3vw;
            font-size: 3.5vw;
            background-color: #2b8c00;
            color: #fff;
            text-decoration: none;
            margin: 0 1vw;
            border-radius: 5px;
        }

        a.button:hover {
            background-color: #fff;
            color: #b64917;
        }

        @media (min-width: 768px) {
            .title {
                font-size: 4.5vw;
                margin-bottom: 1vw;
            }

            .buttons-container {
                margin-top: 1vw;
            }

            .button {
                padding: 1vw 2vw;
                font-size: 2.5vw;
            }
        }
    </style>
</head>
<body>
<div id="video-background">
    <video id="video-content" autoplay loop muted playsinline>
        <source src="IMAGES/MINT.mp4" type="video/mp4">
    </video>
    <div class="content-container">
        <div class="title">GOERLI mint is LIVE!</div>
        <div class="buttons-container">
            <a onclick="mintButton()" class="button" target="_blank" rel="noopener noreferrer">MINT (0.01 GOERLI)</a>
            <br><br>
            <a href="https://testnets.opensea.io/assets/goerli/0x2e1d608c7a5a14bc226217e9f9a7c914fa75bd2c/1" class="button" target="_blank" rel="noopener noreferrer">VIEW ON OPENSEA</a>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.5.3/dist/web3.min.js"></script>
<script type="text/javascript">
    var tokenNumber = '1';

    async function chainCheck(funcpass) {
        // Before we start, let's get on the right chain

        if (window.ethereum && window.ethereum.isMetaMask) {
            try {
                const chainId = await ethereum.request({
                    method: 'eth_chainId'
                });

                if (chainId === '0x5') { // Check for Goerli chain (chainId: 5)
                    if (funcpass === 'mintButton') {
                        mintButton();
                    }
                } else {
                    alert('Change to the Goerli network and try again...');
                }
            } catch (error) {
                console.error('Error retrieving chain ID:', error);
            }
        } else {
            alert('MetaMask is not installed. Please install MetaMask and try again...');
        }
    }

    function mintButton() {
        connectWallet();
        var numMints = parseInt(prompt("Enter the number of tokens to mint", "1"));
        console.log("Minting...");
        ethereum
            .request({
                method: 'eth_sendTransaction',
                params: [
                    {
                        to: '0x2e1d608c7a5a14bc226217e9f9a7c914fa75bd2c',
                        data: web3.eth.abi.encodeFunctionCall({
                            name: 'mintAlbum',
                            type: 'function',
                            inputs: [
                                {
                                    type: 'uint256',
                                    name: 'token_num',
                                },
                                {
                                    type: 'uint256',
                                    name: 'mintcount',
                                },
                            ],
                        }, [tokenNumber, numMints]),
                    },
                ],
            })
            .then((txHash) => loopcheck(txHash))
            .catch((error) => console.error('Error sending transaction:', error));
    }

    async function connectWallet() {
        // Check if the MetaMask provider is available
        if (typeof ethereum !== 'undefined') {
            try {
                // Request access to the user's MetaMask accounts
                await ethereum.request({ method: 'eth_requestAccounts' });

                // Accounts now exposed, you can access the first account using 'ethereum.selectedAddress'
                const accounts = await ethereum.request({ method: 'eth_accounts' });
                const selectedAddress = accounts[0];

                console.log('Connected with address:', selectedAddress);

                // You can now proceed with your Ethereum transactions and interactions

            } catch (error) {
                console.error('Error connecting to wallet:', error);
            }
        } else {
            console.error('MetaMask extension not detected');
        }
    }

    function loopcheck(txHash) {
        txnprogress(txHash);
        exitflag = false;
        checkTXN(txHash);
        if (exitflag === false) {
            intervalID = setInterval(function () { checkTXN(txHash); }, 2000);
        }

        setTimeout(function () {
            if (exitflag === false) {
                error_out('TIMEOUT (TRANSACTION STILL IN PROGRESS)');
            }
            clearInterval(intervalID);
        }, 120000);
    }

    function checkTXN(txHash) {
        try {
            web3.eth.getTransactionReceipt(txHash, (err, receipt) => {
                // If we've got a receipt, check status and log / change text accordingly
                if (receipt.status === true) {
                    clearInterval(intervalID);
                    exitflag = true;
                    document.getElementById('myTXT').innerHTML = 'MINT COMPLETE!';
                } else if (receipt.status === false) {
                    clearInterval(intervalID);
                    exitflag = true;
                    failure();
                }
            });
        } catch (err) {
            clearInterval(intervalID);
            exitflag = true;
            error_out(err);
        }
    }

    async function failure() {
        document.getElementById('myTXT').innerHTML = 'MINT FAILED: <br><button class="button" onclick="mintButton();" style="font-size:12;">TRY AGAIN</button> OR <a href="https://twitter.com">GO BACK TO TWITTER</a>';
    }

    async function txnprogress(txHash) {
        document.getElementById('myTXT').innerHTML = 'TRANSACTION PENDING... <br><a href="https://testnets.opensea.io/asset/0x2e1d608c7a5a14bc226217e9f9a7c914fa75bd2c/' + tokenNumber + '">CHECK OPENSEA STATUS</a>';
    }

    // Call chainCheck function on page load
    chainCheck('');
</script>
</body>
</html>
