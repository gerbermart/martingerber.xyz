<!DOCTYPE html>
<html>
<head>
    <title>ETH Mint Landing Page</title>
    <meta name="description" content="come explore the music & artwork of Martin Gerber (aka Marty Gerbs)">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta property="og:title" content="Martin Gerber aka Marty Gerbs">
    <meta property="og:type" content="article" />
    <meta property="og:description" content="come explore the music & artwork of Martin Gerber (aka Marty Gerbs)">
    <meta property="og:image" content="https://martingerber.xyz/card.jpg">
    <meta property="og:url" content="https://martingerber.xyz/index.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        #video-background {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        #video-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: auto;
            min-height: 100%;
            min-width: 100%;
            object-fit: cover;
        }

        .content-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .title {
            font-size: 4vw;
            margin-bottom: 2vw;
            white-space: nowrap;
        }

        .buttons-container {
            margin-top: 2vw;
        }

        .button-and-input-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2vw;
        }

        .button {
            display: inline-block;
            padding: 1.5vw 3vw;
            font-size: 3.5vw;
            background-color: #2b8c00;
            color: #fff;
            text-decoration: none;
            margin: 0 1vw;
            border-radius: 5px;
        }

        .input {
            width: 6vw;
            height: 3.5vw;
            margin-left: 1vw;
            font-size: 2.5vw;
            padding: 0.5vw;
            border: 1px solid #2b8c00;
            background-color: #2b8c00;
            color: #fff;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        a.button:hover {
            background-color: #fff;
            color: #b64917;
        }

        @media (min-width: 768px) {
            #video-content {
                min-height: unset;
                min-width: unset;
            }

            .title {
                font-size: 4.5vw;
                margin-bottom: 1vw;
            }

            .buttons-container {
                margin-top: 1vw;
            }

            .button {
                padding: 1vw 2vw;
                font-size: 2.5vw;
            }
        }
    </style>
</head>

<body>
    <div id="video-background">
        <video id="video-content" autoplay loop muted playsinline>
            <source src="IMAGES/MINT.mp4" type="video/mp4">
        </video>
        <div class="content-container">
            <div class="buttons-container">
                <div class="title">GOERLI mint is LIVE!</div>
                <div class="button-and-input-container">
                    <a onclick="mintAlbum()" id="mintAlbumBtn" class="button" target="_blank" rel="noopener noreferrer">MINT (0.01 GOERLI)</a>
                    <input type="number" id="mintCountInput" class="input" placeholder="Mint Count" value="1">
                </div>
                <br><br>
                <a onclick="freeMint()" id="freeMintBtn" class="button" target="_blank" rel="noopener noreferrer">MINT (FREE FOR ALLOWLIST)</a>
                <br><br>
                <a href="https://testnets.opensea.io/assets/goerli/0xbb1696ed7CE36a50a947e20F3785DE11460AEcEe/1" class="button" target="_blank" rel="noopener noreferrer">VIEW ON OPENSEA</a>
            </div>
        </div>
    </div>

    <script>
        const ethereumProvider = window.ethereum;
        ethereumProvider.chainId = '0x5'; // Goerli chain ID

        async function estimateGasLimit(transactionParameters) {
            try {
                const gasLimit = await ethereumProvider.request({ method: 'eth_estimateGas', params: [transactionParameters] });
                return gasLimit;
            } catch (error) {
                console.error('Error estimating gas limit:', error);
                throw error;
            }
        }

        async function sendTransaction(transactionParameters) {
            try {
                const result = await ethereumProvider.request({ method: 'eth_sendTransaction', params: [transactionParameters] });
                console.log('Transaction result:', result);
                return result;
            } catch (error) {
                console.error('Error sending transaction:', error);
                throw error;
            }
        }

        async function updateButtonText(buttonId, newText, txHash) {
            const button = document.getElementById(buttonId);
            if (button) {
                const buttonLink = document.createElement('a');
                if (txHash !== undefined && txHash !== 'error') {
                    buttonLink.href = `https://goerli.etherscan.io/tx/${txHash}`;
                }
                buttonLink.textContent = newText;
                buttonLink.target = '_blank';
                buttonLink.rel = 'noopener noreferrer';
                button.textContent = '';
                button.onclick = null;
                button.appendChild(buttonLink);

                // Change the message to "MINT COMPLETE" if the transaction was successful
                if (newText === 'TX IN PROGRESS' && txHash) {
                    const mintCompleteMessage = document.createElement('p');
                    mintCompleteMessage.textContent = 'MINT COMPLETE!';
                    mintCompleteMessage.style.color = '#2b8c00';
                    mintCompleteMessage.style.fontWeight = 'bold';
                    button.parentNode.appendChild(mintCompleteMessage);
                    
                    // Change the video source to "CELEBRATE.mp4"
                    const videoContainer = document.getElementById('video-background');
                    const videoElement = document.getElementById('video-content');
                    videoElement.src = 'IMAGES/CELEBRATE.mp4';
                    videoContainer.style.background = 'transparent';
                }
            }
        }

        async function freeMint() {
            try {
                // Request access to the user's Ethereum accounts
                await ethereumProvider.request({ method: 'eth_requestAccounts' });

                const contractAddress = '0xbb1696ed7CE36a50a947e20F3785DE11460AEcEe'; // Replace with your contract address on the Goerli chain

                const tokenNum = 1; // Replace with the desired token number
                const mintCount = 1; // Replace with the desired mint count

                const tokenNumHex = '0x' + tokenNum.toString(16);
                const mintCountHex = '0x' + mintCount.toString(16);

                const functionSelector = '0x91c09d52'; // Function selector for 'freeMint(uint256,uint256)'
                const data = functionSelector + tokenNumHex.slice(2).padStart(64, '0') + mintCountHex.slice(2).padStart(64, '0');

                const transactionParameters = {
                    from: ethereumProvider.selectedAddress,
                    to: contractAddress,
                    data: data
                };

                // Update button text to indicate transaction in progress
                await updateButtonText('freeMintBtn', 'TX IN PROGRESS', null);

                // Estimate the gas limit
                const gasLimit = await estimateGasLimit(transactionParameters);

                // Add the gas limit to the transaction parameters
                transactionParameters.gas = gasLimit;

                // Send the transaction
                const txHash = await sendTransaction(transactionParameters);

                // Update button text with transaction hash and link
                await updateButtonText('freeMintBtn', `TX IN PROGRESS (View on Etherscan)`, txHash);
                // Update the original button text to "MINT COMPLETE!"
                await updateButtonText('mintAlbumBtn', 'MINT COMPLETE!', null);
            } catch (error) {
                console.error('Error:', error);
                // Update button text to display the error message from the contract
                await updateButtonText('freeMintBtn', error.message, null);
            }
        }

        async function mintAlbum() {
            try {
                // Request access to the user's Ethereum accounts
                await ethereumProvider.request({ method: 'eth_requestAccounts' });

                const contractAddress = '0xbb1696ed7CE36a50a947e20F3785DE11460AEcEe'; // Replace with your contract address on the Goerli chain

                const tokenNum = 1; // Replace with the desired token number
                const mintCountInput = document.getElementById('mintCountInput');
                const mintCount = mintCountInput.value || 1; // Replace with the desired mint count

                const tokenNumHex = '0x' + tokenNum.toString(16);
                const mintCountHex = '0x' + mintCount.toString(16);

                const functionSelector = '0x4cb16ced'; // Function selector for 'mintAlbum(uint256,uint256)'
                const data = functionSelector + tokenNumHex.slice(2).padStart(64, '0') + mintCountHex.slice(2).padStart(64, '0');

                const transactionParameters = {
                    from: ethereumProvider.selectedAddress,
                    to: contractAddress,
                    data: data,
                    value: '0x' + (mintCount * 0.01 * 1e18).toString(16) // 0.01 * mintCount ETH in Wei
                };

                // Update button text to indicate transaction in progress
                await updateButtonText('mintAlbumBtn', 'TX IN PROGRESS', null);

                // Estimate the gas limit
                const gasLimit = await estimateGasLimit(transactionParameters);

                // Add the gas limit to the transaction parameters
                transactionParameters.gas = gasLimit;

                // Send the transaction
                const txHash = await sendTransaction(transactionParameters);

                // Update button text with transaction hash and link
                await updateButtonText('mintAlbumBtn', `TX IN PROGRESS (View on Etherscan)`, txHash);
                // Update the original button text to "MINT COMPLETE!"
                await updateButtonText('mintAlbumBtn', 'MINT COMPLETE!', null);
            } catch (error) {
                console.error('Error:', error);
                // Update button text to display the error message from the contract
                await updateButtonText('mintAlbumBtn', error.message, null);
            }
        }
    </script>
</body>

</html>
