<html>
<head>


    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        async function getWaddy(){
            if (typeof window.ethereum !== 'undefined') {
                console.log('MetaMask is installed!');
            }
            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            const account = accounts[0];
            myWaddy=account.toLowerCase();
            $("#waddyid").html(myWaddy);
        };
        function getOwners(){
            let contract = myContract.value;
            text='';
            let testWaddy = myWaddy;
            stopper='no';
            for (let i=1;((i<100) & (stopper=='no'));i++){
                
                const url_str='https://api.opensea.io/api/v1/asset/'+contract+'/'+i.toString()+'/owners';
                const settings = {
                async: true,
                crossDomain: true,
                url: url_str,
                method: 'GET',
                headers: {}
                };
            
                $(document).ready(function(){
                    $("#msgid").html('doin stuff...');
                    $.ajax(settings).done(function (response) {
                        
                        const json = JSON.stringify(response).replace(/[\r\n]/gm, '');
                        
                        const obj = JSON.parse(json);
                        
                        if (obj.length==0){
                            stopper='yes';
                        }
                        
                        for (let i = 0; i < obj.owners.length; i++) {
                        text += obj.owners[i].owner.address.toString() + "<br>";
                        } 
                        var addresses = text.split('<br>')
                        if ((testWaddy!='') & (addresses.includes(testWaddy))){
                            $("#msgid").html(text+'<br>includes testWaddy');
                        } else {
                            $("#msgid").html(text+'<br>does NOT include testWaddy');
                        }
                        
                    });
                    
                });
            };
        };
    
    </script>

</head>

<body>

<h1>ETH NFT Owners</h1>
<p>Enter your NFT Contract Address & Token ID:</p>
<input type="text" size="50" id="myContract" />


<button type="button" onClick="getWaddy();">Get Waddy</button>

<button type="button" onClick="getOwners();">Get Owners</button>

<p>My Wallet ID (replace w/ WalletConnect):</p>
<div id="waddyid">
</div>
<p>Token Owners & Match Result:</p>
<br>
<div id="msgid">
</div>

</body>
</html>